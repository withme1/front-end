{"ast":null,"code":"var _jsxFileName = \"/var/www/front-end/src/main/chat/Chat.js\",\n    _s = $RefreshSig$();\n\n/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { Button, TextField } from '@mui/material';\nimport ChatView from './ChatView';\nimport { getSocket } from '../../socket/socket';\nimport { useEffect, useRef, useState } from 'react';\nimport dayjs from 'dayjs';\nimport { jsxDEV as _jsxDEV } from \"@emotion/react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"@emotion/react/jsx-dev-runtime\";\nconst chatStyle = css`\n  height: calc(100% - 8px);\n  margin: 3px;\n\n  display: flex;\n  flex-direction: column;\n`;\nconst textFieldStyle = {\n  flexGrow: '1',\n  '.MuiOutlinedInput-root input': {\n    padding: \"5px;\",\n    fontSize: '0.8em',\n    height: '20px'\n  },\n  '.MuiOutlinedInput-root fieldset': {\n    borderColor: 'green'\n  },\n  '.MuiOutlinedInput-root.Mui-focused fieldset': {\n    borderColor: 'green'\n  }\n};\nconst sendButtonStyle = {\n  boxShadow: \"0 0 0\",\n  backgroundColor: \"#2BAE66\",\n  padding: \"0px\",\n  fontSize: '0.8em',\n  width: '55px',\n  minWidth: '55px',\n  \"&:hover\": {\n    boxShadow: \"0 0 0\",\n    backgroundColor: \"#2BAE66\"\n  }\n};\nconst leaveButtonStyle = {\n  boxShadow: \"0 0 0\",\n  backgroundColor: \"#ff5b5b\",\n  padding: \"0px\",\n  fontSize: '0.8em',\n  width: '55px',\n  minWidth: '55px',\n  \"&:hover\": {\n    boxShadow: \"0 0 0\",\n    backgroundColor: \"#ff5b5b\"\n  }\n};\n\nconst checkMessage = m => {\n  if (m === '') return false;\n  return true;\n};\n\nfunction Chat(_ref) {\n  _s();\n\n  let {\n    isInRoom,\n    setIsInRoom,\n    isHost,\n    setIsHost,\n    roomId,\n    setRoomId,\n    chatList,\n    setChatList,\n    addMessage,\n    setRoomList\n  } = _ref;\n  const [message, setMessage] = useState('');\n  const chatStyleRef = useRef();\n\n  const refreshScroll = () => {\n    setTimeout(() => chatStyleRef.current.scrollTop = chatStyleRef.current.scrollHeight, 0);\n  };\n\n  const chatHandler = e => {\n    e.preventDefault();\n    if (!isInRoom) return;\n    if (checkMessage(message)) getSocket().emit('sendMessageReq', {\n      message: message,\n      time: dayjs().format('HH:mm:ss')\n    });\n  };\n\n  const leaveHandler = e => {\n    getSocket().emit('deleteRoomReq');\n  };\n\n  useEffect(() => {\n    getSocket().on('deleteRoomRes', res => {\n      if (res.ok) {\n        setRoomList(prev => prev.filter(room => room.id !== roomId));\n        addMessage({\n          type: 'system',\n          text: '퇴장'\n        });\n        setIsInRoom(false);\n        setIsHost(false);\n      } else {\n        alert(res.reason);\n      }\n    });\n    getSocket().on('roomDeleted', id => {\n      setRoomList(prev => prev.filter(room => room.id !== roomId));\n\n      if (isInRoom) {\n        addMessage({\n          type: 'system',\n          text: '방장이 방 삭제'\n        });\n        setIsInRoom(false);\n        setIsHost(false);\n      }\n    });\n    getSocket().on('sendMessageRes', res => {\n      if (res.ok) {\n        addMessage({\n          type: 'me',\n          text: res.message,\n          time: dayjs('2020-01-01 ' + res.time)\n        });\n        setMessage('');\n        refreshScroll();\n      } else {\n        alert(res.reason);\n      }\n    });\n    getSocket().on('messageReceived', res => {\n      addMessage({\n        type: 'other',\n        text: res.message,\n        time: dayjs('2020-01-01 ' + res.time)\n      });\n      refreshScroll();\n    });\n  }, []);\n  return _jsxDEV(\"div\", {\n    css: chatStyle,\n    children: [isInRoom ? _jsxDEV(\"div\", {\n      css: css`height: 25px; display: flex; flex-direction: row-reverse; justify-content: center; padding-bottom: 3px;`,\n      children: _jsxDEV(Button, {\n        variant: \"contained\",\n        sx: leaveButtonStyle,\n        onClick: leaveHandler,\n        children: isHost ? '방 삭제' : '방 퇴장'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 11\n    }, this) : _jsxDEV(_Fragment, {}, void 0, false), _jsxDEV(ChatView, {\n      chatList: chatList,\n      setChatList: setChatList,\n      chatStyleRef: chatStyleRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this), _jsxDEV(\"form\", {\n      css: css`display:flex;height:30px;`,\n      onSubmit: chatHandler,\n      children: [_jsxDEV(TextField, {\n        autoComplete: \"off\",\n        sx: textFieldStyle,\n        value: message,\n        onChange: e => setMessage(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this), _jsxDEV(Button, {\n        variant: \"contained\",\n        sx: sendButtonStyle,\n        onClick: chatHandler,\n        children: \"\\uBCF4\\uB0B4\\uAE30\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Chat, \"tjOKBvza8WhyDgoF9Du2iSJLsqk=\");\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["css","Button","TextField","ChatView","getSocket","useEffect","useRef","useState","dayjs","chatStyle","textFieldStyle","flexGrow","padding","fontSize","height","borderColor","sendButtonStyle","boxShadow","backgroundColor","width","minWidth","leaveButtonStyle","checkMessage","m","Chat","isInRoom","setIsInRoom","isHost","setIsHost","roomId","setRoomId","chatList","setChatList","addMessage","setRoomList","message","setMessage","chatStyleRef","refreshScroll","setTimeout","current","scrollTop","scrollHeight","chatHandler","e","preventDefault","emit","time","format","leaveHandler","on","res","ok","prev","filter","room","id","type","text","alert","reason","target","value"],"sources":["/var/www/front-end/src/main/chat/Chat.js"],"sourcesContent":["/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport { Button, TextField } from '@mui/material';\nimport ChatView from './ChatView';\nimport { getSocket } from '../../socket/socket'\nimport { useEffect, useRef, useState } from 'react';\nimport dayjs from 'dayjs';\n\nconst chatStyle = css`\n  height: calc(100% - 8px);\n  margin: 3px;\n\n  display: flex;\n  flex-direction: column;\n`;\n\nconst textFieldStyle = {\n  flexGrow: '1',\n  '.MuiOutlinedInput-root input': {\n    padding: \"5px;\",\n    fontSize: '0.8em',\n    height: '20px',\n  },\n  '.MuiOutlinedInput-root fieldset': {\n    borderColor: 'green',\n  },\n  '.MuiOutlinedInput-root.Mui-focused fieldset': {\n    borderColor: 'green',\n  }\n};\n\nconst sendButtonStyle = {\n  boxShadow: \"0 0 0\",\n  backgroundColor: \"#2BAE66\",\n  padding: \"0px\",\n  fontSize: '0.8em',\n  width: '55px',\n  minWidth: '55px',\n\n  \"&:hover\": {\n    boxShadow: \"0 0 0\",\n    backgroundColor: \"#2BAE66\"\n  }\n};\n\nconst leaveButtonStyle = {\n  boxShadow: \"0 0 0\",\n  backgroundColor: \"#ff5b5b\",\n  padding: \"0px\",\n  fontSize: '0.8em',\n  width: '55px',\n  minWidth: '55px',\n\n  \"&:hover\": {\n    boxShadow: \"0 0 0\",\n    backgroundColor: \"#ff5b5b\"\n  }\n};\n\nconst checkMessage = (m) => {\n  if (m === '')\n    return false;\n  return true;\n}\n\nfunction Chat({ isInRoom, setIsInRoom, isHost, setIsHost, roomId, setRoomId, chatList, setChatList, addMessage, setRoomList }) {\n  const [message, setMessage] = useState('');\n  const chatStyleRef = useRef();\n\n  const refreshScroll = () => {\n    setTimeout(() => chatStyleRef.current.scrollTop = chatStyleRef.current.scrollHeight, 0);\n  }\n\n  const chatHandler = (e) => {\n    e.preventDefault();\n    if (!isInRoom)\n      return;\n\n    if (checkMessage(message))\n      getSocket().emit('sendMessageReq', { message: message, time: dayjs().format('HH:mm:ss') });\n  }\n\n  const leaveHandler = (e) => {\n    getSocket().emit('deleteRoomReq');\n  }\n\n  useEffect(() => {\n    getSocket().on('deleteRoomRes', (res) => {\n      if (res.ok) {\n        setRoomList((prev) => (prev.filter((room) => room.id !== roomId)));\n        addMessage({ type: 'system', text: '퇴장' });\n        setIsInRoom(false);\n        setIsHost(false);\n      } else {\n        alert(res.reason)\n      }\n    })\n    getSocket().on('roomDeleted', (id) => {\n      setRoomList((prev) => (prev.filter((room) => room.id !== roomId)));\n      if (isInRoom) {\n        addMessage({type: 'system', text: '방장이 방 삭제'});\n        setIsInRoom(false);\n        setIsHost(false);\n      }\n    })\n    getSocket().on('sendMessageRes', (res) => {\n      if (res.ok) {\n        addMessage({ type: 'me', text: res.message, time: dayjs('2020-01-01 ' + res.time) });\n        setMessage('');\n        refreshScroll();\n      } else {\n        alert(res.reason)\n      }\n    })\n    getSocket().on('messageReceived', (res) => {\n      addMessage({ type: 'other', text: res.message, time: dayjs('2020-01-01 ' + res.time) });\n      refreshScroll();\n    })\n  }, [])\n\n  return (\n    <div css={chatStyle}>\n      {isInRoom\n        ? <div css={css`height: 25px; display: flex; flex-direction: row-reverse; justify-content: center; padding-bottom: 3px;`}>\n          <Button variant=\"contained\" sx={leaveButtonStyle} onClick={leaveHandler}>{isHost ? '방 삭제' : '방 퇴장'}</Button>\n        </div>\n        : <></>}\n      <ChatView chatList={chatList} setChatList={setChatList} chatStyleRef={chatStyleRef} />\n      <form css={css`display:flex;height:30px;`} onSubmit={chatHandler}>\n        <TextField autoComplete='off' sx={textFieldStyle} value={message} onChange={(e) => setMessage(e.target.value)} />\n        <Button variant=\"contained\" sx={sendButtonStyle} onClick={chatHandler}>보내기</Button>\n      </form>\n    </div>\n  )\n}\n\nexport default Chat;"],"mappings":"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"},"metadata":{},"sourceType":"module"}